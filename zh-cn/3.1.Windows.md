### Windows

Dockeråœ¨Windowsä¸‹å®ç°çš„åº•å±‚æŠ€æœ¯æ–¹æ¡ˆæ˜¯é€šè¿‡Windowsè‡ªå¸¦çš„hyper-vè™šæ‹Ÿæœºæ¥å®ç°çš„ï¼Œä¸”é»˜è®¤ä½¿ç”¨natç½‘ç»œæ¨¡å¼ï¼Œè¿™ä¸€ç‰¹æ€§ä½¿å¾—åœ¨ä½¿ç”¨nmapç­‰å·¥å…·è¿›è¡Œå±€åŸŸç½‘æ‰«æçš„æ—¶å€™ï¼Œéƒ¨åˆ†åœºæ™¯ä¸‹å¯èƒ½ä¼šå‡ºç°å¼‚å¸¸ï¼Œæ‰€ä»¥æœ¬æ•™ç¨‹å»ºè®®ï¼Œå¦‚æœç”µè„‘é…ç½®è¶³å¤Ÿï¼Œé‚£ä¹ˆä¼˜å…ˆå»ºè®®ä½¿ç”¨`è™šæ‹Ÿæœº+Linux`çš„é€‰é¡¹ï¼Œè¿™æ ·æ›´åŠ ç¨³å®šï¼Œå‡ ä¹ä¸ä¼šå‡ºç°å¼‚å¸¸æƒ…å†µã€‚

#### 1. Dockeå®‰è£…

##### 1.1 Dockerçš„ç¯å¢ƒé…ç½®

 å‰ç½®çŸ¥è¯†ï¼š[ä»€ä¹ˆæ˜¯docker](https://www.redhat.com/zh/topics/containers/what-is-docker)

 å¦‚æœä½ çš„è®¾å¤‡ä¸Šå·²ç»å®‰è£…è¿‡dockerï¼Œè¯·æ£€æŸ¥å…¶ç‰ˆæœ¬å·ï¼Œæ½®æ±æ”¯æŒçš„ç‰ˆæœ¬å·ä¸ä½äº**20.10.10**ï¼Œå¦åˆ™è¯·è¿›è¡Œæ›´æ–°ï¼Œä¸”å¯ä»¥è·³è¿‡æ­¤æ­¥éª¤ã€‚

 Windowsç³»ç»Ÿå®‰è£…dockeræ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦å…ˆå¼€å¯Windowsç³»ç»Ÿå†…ç½®çš„hyper-våŠŸèƒ½ï¼Œå»ºè®®ä½¿ç”¨Linuxç³»ç»Ÿæˆ–è€…WSLï¼Œæ–¹ä¾¿å¿«æ·ï¼Œä»¥ä¸‹æ•™ç¨‹ä»¥Win10ä¸ºç¤ºä¾‹ï¼Œä¸”æŒ‰ç…§Win10ç³»ç»Ÿç‰ˆæœ¬åˆ’åˆ†(å¦‚æœä¸çŸ¥é“è‡ªå·±Win10ç³»ç»Ÿç‰ˆæœ¬ï¼Œè¯·ç™¾åº¦)ã€‚



##### 1.2 å¼€å¯CPUæ”¯æŒè™šæ‹ŸåŒ–

 è¿›å…¥ç³»ç»ŸBIOSè®¾ç½®ï¼ŒæŸ¥çœ‹BIOSæ˜¯å¦å¼€å¯CPUçš„è™šæ‹ŸåŒ–æ”¯æŒï¼Œå¦‚ä¸‹å›¾ï¼š

 ![å¼€å¯è™šæ‹ŸåŒ–æ”¯æŒ.jpg](https://levimg.s3.cn-northwest-1.amazonaws.com.cn/x/2e12d9cd-cf65-4c6c-88a2-1b6d42110f22.JPEG)



##### 1.3 Win10å®¶åº­ç‰ˆ å‰ç½®æ­¥éª¤

 å¼ºçƒˆå»ºè®®å‡çº§Win10ä¸“ä¸šç‰ˆæˆ–è€…ä½¿ç”¨Linuxï¼ŒMacï¼Œ**å¦‚æœæ˜¯Win10ä¸“ä¸šç‰ˆæˆ–è€…ä¼ä¸šç‰ˆã€æ•™è‚²ç‰ˆï¼Œè¯·è·³è¿‡æ­¤æ­¥éª¤ï¼Œè¿›å…¥1.4**ã€‚

 é¦–å…ˆéœ€è¦å¯ç”¨hyper-væ¨¡å—ï¼ŒWindowså®¶åº­ç‰ˆæ— æ³•æŸ¥è¯¢åˆ°hyper-våŠŸèƒ½æ¨¡å—ï¼Œéœ€è¦ç‰¹æ®Šæ–¹å¼å¯ç”¨ï¼Œå¦‚ä¸‹:

 æ›´æ–°æ“ä½œç³»ç»Ÿè‡³æœ€æ–°ç‰ˆæœ¬ï¼ŒWindowsè®¾ç½® -> æ›´æ–° -> æ£€æŸ¥æ›´æ–°

 å¼€å¯æ˜¾ç¤ºæ–‡ä»¶æ‰©å±•åï¼Œè¯¦æƒ…å‚è€ƒ[æ˜¾ç¤ºæ–‡ä»¶æ‰©å±•å](https://jingyan.baidu.com/article/f7ff0bfcc9c0e12e26bb13a0.html)



 å°†ä¸‹é¢ä»£ç æ‹·å…¥æ–°å»ºæ–‡æ¡£:

```
pushd "%~dp0"
dir /b %SystemRoot%\servicing\Packages\*Hyper-V*.mum >hyper-v.txt
for /f %%i in ('findstr /i . hyper-v.txt 2^>nul') do dism /online /norestart /add-package:"%SystemRoot%\servicing\Packages\%%i"
del hyper-v.txt
Dism /online /enable-feature /featurename:Microsoft-Hyper-V-All /LimitAccess /ALL
```

 å°†æ–‡æ¡£å¦å­˜ä¸ºinstall-hyper-v.cmdï¼Œå³é”®ç‚¹å‡» ç®¡ç†å‘˜è¿è¡Œ

![å®‰è£…hyper-v.png](https://levimg.s3.cn-northwest-1.amazonaws.com.cn/x/61620bb6-2a0d-4974-a27c-39471f7c0020.png)



 å®‰è£…å®Œæ¯•åè¾“å…¥Yï¼Œé‡å¯(æ³¨æ„ï¼š**å¦‚æœå®‰è£…å®Œæ¯•ä¹‹åæ›´æ–°ç³»ç»Ÿï¼Œæœ‰å¯èƒ½é€ æˆå®‰è£…æ— æ•ˆï¼Œéœ€è¦æ£€æŸ¥ï¼Œæœ‰å¿…è¦çš„è¯éœ€è¦é‡æ–°å®‰è£…hyper-v)**



 é‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œå°†å¦‚ä¸‹ä»£ç å¦å­˜ä¸ºchange.cmdå¹¶ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼š

 `REG ADD "HKEY_LOCAL_MACHINE\software\Microsoft\Windows NT\CurrentVersion" /v EditionId /T REG_EXPAND_SZ /d Professional /F`

 è‡³æ­¤ï¼ŒWin10å®¶åº­ç‰ˆhyper-vå¯ç”¨å®Œæ¯•ã€‚



##### 1.4 Win10ä¸“ä¸šç‰ˆã€ä¼ä¸šç‰ˆã€æ•™è‚²ç‰ˆ

 å¦‚æœæ˜¯ä¸“ä¸šç‰ˆã€æ•™è‚²ç‰ˆæˆ–è€…ä¼ä¸šç‰ˆï¼Œé‚£ä¹ˆä¸éœ€è¦åƒå®¶åº­ç‰ˆé‚£ä¹ˆéº»çƒ¦ï¼Œç›´æ¥åœ¨ æ§åˆ¶é¢æ¿ -> ç¨‹åº -> å¯ç”¨æˆ–å…³é—­WindowsåŠŸèƒ½ -> å‹¾é€‰ hyper-v ï¼Œç„¶åæŒ‰ç…§æç¤ºé‡å¯å³å¯ã€‚

 ä»¥ä¸‹æ­¥éª¤é€šç”¨ï¼Œæ‰€æœ‰Windowsç³»ç»Ÿéƒ½å¿…é¡»æ‰§è¡Œï¼š



 å¼€å¯æ˜¾ç¤ºæ–‡ä»¶æ‰©å±•åï¼Œè¯¦æƒ…å‚è€ƒ[æ˜¾ç¤ºæ–‡ä»¶æ‰©å±•å](https://jingyan.baidu.com/article/f7ff0bfcc9c0e12e26bb13a0.html)

 ä¸‹è½½dockerå®‰è£…æ–‡ä»¶[dockerå®‰è£…ç¨‹åºä¸‹è½½](https://desktop.docker.com/win/main/amd64/Docker%20Desktop%20Installer.exe)

 ç‚¹å‡»æ–‡ä»¶å¼€å§‹å®‰è£…dockerï¼ˆå®¶åº­ç‰ˆéœ€è¦åœ¨å®‰è£…æ—¶å–æ¶ˆå‹¾é€‰Windowså®¹å™¨WSL2é‚£ä¸ªé€‰é¡¹ï¼Œå…¶ä»–ç‰ˆæœ¬ä¸éœ€è¦ï¼‰

 ç­‰å¾…å®‰è£…æˆåŠŸé‡å¯ã€‚é‡å¯ä¹‹åï¼Œæ‰“å¼€dockeræ¡Œé¢å®¢æˆ·ç«¯å›¾æ ‡ï¼Œ**Windows**ä¸‹dockeræœ‰å›¾å½¢åŒ–ç•Œé¢ï¼š

 å›¾å½¢åŒ–ç•Œé¢å·¦ä¸‹è§’dockerå¼•æ“æ ‡è¯†å‘ˆç»¿è‰²åˆ™æˆåŠŸå¯åŠ¨![image.png](https://levimg.s3.cn-northwest-1.amazonaws.com.cn/x/87fe783c-f999-4b50-85f9-99a0080d6561.png)

 å¦‚æœæ˜¾ç¤ºdockerå¯åŠ¨å¤±è´¥ï¼ŒæŠ¥é”™"**å› ä¸ºä¸€ä¸ªHyper-Vç»„ä»¶æœªè¿è¡Œ**"ï¼Œé‚£ä¹ˆå°±æ˜¯æ²¡æœ‰å¯åŠ¨ç¡¬ä»¶è™šæ‹ŸåŒ–ï¼Œè¯·æ‰§è¡Œç¬¬ä¸€æ­¥: **1.2 å¼€å¯CPUæ”¯æŒè™šæ‹ŸåŒ–**ã€‚



#### 2. Python3.10å®‰è£…

Windowså®‰è£…pythonå¾ˆç®€å•æ–¹ä¾¿ï¼Œ[å®˜ç½‘ä¸‹è½½](https://www.python.org/downloads/)æœ€æ–°ç‰ˆæœ¬çš„pythonå®‰è£…åŒ…(éœ€è¦ç‰ˆæœ¬>3.10)ï¼Œç‚¹å‡»å®‰è£…å³å¯ï¼Œå®‰è£…å®Œæˆåé‡å¯ï¼Œéœ€è¦åœ¨cmdæˆ–è€…powershellä¸­ç¡®è®¤pythonæ˜¯å¦æˆåŠŸåŠ å…¥äº†ç¯å¢ƒå˜é‡ã€‚

python3 å®‰è£…å®Œæ¯•åï¼Œè¯·é…ç½®æ¸…åå¤§å­¦çš„pipæºï¼Œå¦åˆ™åœ¨å®‰è£… python ä¾èµ–åŒ…çš„æ—¶å€™é€Ÿåº¦ä¼šå¾ˆæ…¢ã€‚

#### 3. PDM å®‰è£…

ä¸Šä¸€æ­¥ python3.10 å®‰è£…å®Œæ¯•ä¹‹åï¼Œå¼€å§‹å®‰è£… PDM å·¥å…·ã€‚

PDM æ˜¯ä¸€ä¸ªç°ä»£ Python åŒ…ç®¡ç†å™¨ï¼Œæ”¯æŒ[PEP 582](https://www.python.org/dev/peps/pep-0582/)ã€‚å®ƒä»¥ç±»ä¼¼äº npmï¼Œä»¥æ ¹æœ¬ä¸éœ€è¦åˆ›å»º virtualenv çš„æ–¹å¼å®‰è£…å’Œç®¡ç†åŒ…ã€‚æ½®æ±å¼€æºç¤¾åŒºåˆ©ç”¨ PDM å¯¹å·¥å…·ä¸ç¼–æ’ä½œè€…åœ¨æœ¬åœ°è¿˜æœªå‘å¸ƒçš„åŒ…è¿›è¡Œæš‚æ—¶ç®¡ç†ï¼ŒåŒæ—¶ä¹Ÿåˆ©ç”¨ PDM è¿›è¡Œæœ¬åœ°å·¥å…·ä¸ç¼–æ’çš„å¯ç”¨æ€§æµ‹è¯•ï¼Œå·¥å…·ä¸ç¼–æ’çš„ç¤¾åŒºä¸Šä¼ ä¹Ÿéœ€è¦ PDM çš„æ”¯æŒï¼Œä¸‹æ–‡å°†ä»‹ç» PDM çš„å®‰è£…ä¸ç”¨æˆ·æœ¬åœ°çš„ç›¸å…³é…ç½®ã€‚[ä»€ä¹ˆæ˜¯ PDMï¼Ÿ](https://pdm.fming.dev/)

PDM å®˜æ–¹æä¾›äº†Windowsä¸‹çš„å®‰è£…è„šæœ¬ï¼š`(Invoke-WebRequest -Uri https://raw.githubusercontent.com/pdm-project/pdm/main/install-pdm.py -UseBasicParsing).Content | python -`

ç›´æ¥åœ¨ cmd æˆ–è€… powershell ä¸­æ‰§è¡Œå³å¯ï¼Œå»ºè®®ä½¿ç”¨ æ¸…åå¤§å­¦çš„pipæºã€‚å®‰è£…å®Œæ¯•ä¹‹åå¯¹ PDM è¿›è¡Œä¸€äº›é…ç½®ï¼š

1. PDM  å®‰è£…å®Œæ¯•ï¼Œéœ€è¦è¿›è¡Œä¸€äº›æ“ä½œæ¥éªŒè¯ PDM å·¥å…·å®‰è£…æ˜¯å¦æ²¡æœ‰é—®é¢˜

   * åœ¨ powershell ä¸­æ‰§è¡Œå‘½ä»¤

      ```bash
      $ pdm plugin add pdm-lev
      ```

     æ‰§è¡Œå®Œæ¯•ä¹‹åç»ˆç«¯è¿”å›:

     ```bash
     âœ” Installation succeeds.
     ```

     å°±è¡¨ç¤ºå®‰è£…æˆåŠŸï¼Œå‡ºç°å…¶ä»–å¼‚å¸¸æƒ…å†µï¼Œè¯·æ£€æŸ¥æ˜¯å¦æŒ‰ç…§ä¸Šä¸€æ­¥çš„æ“ä½œæ­£ç¡®æ‰§è¡Œ

   * æ¥ä¸‹æ¥æ‰§è¡Œç¬¬äºŒä¸ªéªŒè¯æ­¥éª¤ï¼š

     ```bash
     $ mkdir tmp #åˆ›å»ºä¸´æ—¶æ–‡ä»¶å¤¹
     $ cd tmp #è¿›å…¥ä¸´æ—¶æ–‡ä»¶å¤¹
     $ pdm lev new test.demo #åˆ›å»ºæµ‹è¯•é¡¹ç›®
     ```

     åˆ›å»ºæµ‹è¯•é¡¹ç›®ä¹‹åä¼šå‡ºç°æç¤ºè¾“å‡ºï¼š

     ```shell
     Using Python interpreter: /usr/local/bin/python3.10 (3.10)
     Changes are written to pyproject.toml.
     ```

     æ­¤æ—¶è¡¨ç¤ºå·²ç» test é¡¹ç›®åˆ›å»ºæˆåŠŸ

   * ç¬¬ä¸‰ä¸ªéªŒè¯æ­¥éª¤ï¼š

     ```bash
     $ cd test.demo
     $ pdm add levrt
     ```

     ç»ˆç«¯å¦‚æœè¾“å‡ºå¦‚ä¸‹å†…å®¹ï¼Œåˆ™è¡¨ç¤ºæˆåŠŸ:

     ```shell
     Adding packages to default dependencies: levrt
     âœ” ğŸ”’ Lock successful
     Changes are written to pdm.lock.
     Changes are written to pyproject.toml.
     Synchronizing working set with lock file: 17 to add, 0 to update, 0 to remove
      
       âœ” Install aiofiles 0.8.0 successful
       âœ” Install anyio 3.5.0 successful
       âœ” Install certifi 2021.10.8 successful
       âœ” Install charset-normalizer 2.0.12 successful
       âœ” Install idna 3.3 successful
       âœ” Install httpcore 0.14.7 successful
       âœ” Install h11 0.12.0 successful
       âœ” Install httpx 0.22.0 successful
       âœ” Install levrt 1.3.2 successful
       âœ” Install motor 2.5.1 successful
       âœ” Install mpmath 1.2.1 successful
       âœ” Install msgpack 1.0.3 successful
       âœ” Install nats-py 2.0.0 successful
       âœ” Install pymongo 3.12.3 successful
       âœ” Install rfc3986 2.0.0 successful
       âœ” Install sniffio 1.2.0 successful
       âœ” Install sympy 1.10.1 successful
     Installing the project as an editable package...
       âœ” Install lev.test.demo 0.1.0 successful
      
     ğŸ‰ All complete!
     ```

     å¦åˆ™ä¾¿æ˜¯æœªå®‰è£…æˆåŠŸï¼Œè¯·æ£€æŸ¥æ˜¯å¦æŒ‰ç…§ä¹‹å‰çš„æç¤ºæ“ä½œ

     æµ‹è¯•æˆåŠŸä¹‹åå³å¯åˆ æ‰`test.demo`æ–‡ä»¶å¤¹

2. PDM å®‰è£…å®Œæ¯•ï¼Œéœ€è¦é…ç½® pep582 ç¯å¢ƒå˜é‡çš„æ–¹å¼ï¼Œå…¨å±€å¯ç”¨ pep582 (æ‘˜è‡ª pdm å®˜ç½‘) ï¼š

   ```powershell
   #powershell
   $ mkdir $PROFILE\..\Completions
   $ echo @'
   Get-ChildItem "$PROFILE\..\Completions\" | ForEach-Object {
       . $_.FullName
   }
   '@ | Out-File -Append -Encoding utf8 $PROFILE
   # Generate script
   $ Set-ExecutionPolicy Unrestricted -Scope CurrentUser
   $ pdm completion powershell | Out-File -Encoding utf8 $PROFILE\..\Completions\pdm_completion.ps1
   $ pdm --pep582
   # è®¾ç½®å®Œæ¯•å‹é‡å¯ç»ˆç«¯
   ```

3. æ¥ä¸‹æ¥é…ç½® IDEï¼Œèƒ½å¤Ÿæ‰¾åˆ°ä½¿ IDE æ”¯æŒ PDM çš„è®¾ç½®æ–¹å¼ï¼Œåˆ—ä¸¾äº†ä¸¤ç§ IDE ï¼šPyCharmã€VSCodeï¼Œå»ºè®®ä½¿ç”¨VSCodeã€‚

   ###### IDEé€šç”¨è®¾ç½®

   ```bash
   #ç°åœ¨å¤§å¤šæ•° IDE ä¸­éƒ½æ²¡æœ‰ PEP 582 çš„å†…ç½®æ”¯æŒæˆ–æ’ä»¶ï¼Œä½ å¿…é¡»æ‰‹åŠ¨é…ç½®ä½ çš„å·¥å…·ã€‚
   #PDM å°†åœ¨ .pdm.toml ä¸­å†™å…¥å­˜å‚¨é¡¹ç›®èŒƒå›´çš„é…ç½®ï¼Œå»ºè®®åœ¨ .gitignore ä¸­æ·»åŠ ä»¥ä¸‹è¡Œï¼š
   .pdm.toml
   __pypackages__/
   ```

   ###### PyCharmè®¾ç½®

   ```bash
   #å°† __pypackages__/<major.minor>/lib æ ‡è®°ä¸ºæºæ ¹ï¼ˆSources Rootï¼‰ã€‚
   
   #æ­¤å¤–ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨ç¯å¢ƒä¸­çš„å·¥å…·ï¼ˆä¾‹å¦‚pytestï¼‰ï¼Œå¿…é¡»å°†__pypackages__/<major.minor>/bin ç›®å½•æ·»åŠ åˆ° PATH ç›¸åº”è¿è¡Œæˆ–è°ƒè¯•é…ç½®çš„å˜é‡ä¸­ã€‚
   ```

   ###### VSCodeè®¾ç½®

   ```json
   #å°†ä»¥ä¸‹ä¸¤åˆ—åŠ å…¥è®¾ç½®çš„é¡¶çº§å­—å…¸.vscode/settings.jsonä¸­ï¼Œå¯åœ¨vscodeç•Œé¢settingsä¸­ï¼Œé€‰æ‹©Edit in settings.jsonæ‰“å¼€ï¼š
   {
     "python.autoComplete.extraPaths": ["__pypackages__/<major.minor>/lib"],
     "python.analysis.extraPaths": ["__pypackages__/<major.minor>/lib"]
   }
   ```

   æ³¨ï¼šç¼–è¯‘å™¨å…³äºPDMè®¾ç½®çš„`<major.minor>`åœ¨åŠ å…¥é…ç½®æ—¶ï¼Œåº”è¯¥æ˜¯è‡ªå·±ç”µè„‘ Python3 çš„ç‰ˆæœ¬å·ï¼Œå¦‚`__pypackages__/3.10/lib`ã€‚

#### 4. python ç¯å¢ƒä¾èµ–

ä½ åœ¨æ¥ä¸‹æ¥çš„æ­¥éª¤å¯èƒ½é‡åˆ°å„ç§é”™è¯¯ï¼Œè­¬å¦‚è¿è¡Œä»£ç çš„æ—¶å€™ä¼šæç¤ºï¼š`  No module named 'pdm' ` ,`  No module named 'levrt' `ç­‰ï¼Œå¾ˆå¤§æ¦‚ç‡æ˜¯ä½ çš„pythonç¯å¢ƒä¾èµ–å‡ºç°äº†å¼‚å¸¸ã€‚

å¦‚æœä½ æ˜¯é€šè¿‡ pip å®‰è£…çš„ pdmï¼Œé‚£ä¹ˆåœ¨è¿è¡Œçš„æ—¶å€™éœ€è¦ä¿è¯ä½¿ç”¨çš„æ˜¯ pip æ‰€æ†ç»‘çš„ python è§£é‡Šå™¨ æ¥æ‰§è¡Œå…·ä½“ä»£ç ã€‚



#### 5. pdm-levæ’ä»¶ç®€ä»‹

pdm-levæ˜¯æ½®æ±å®˜æ–¹æä¾›çš„pdmæ’ä»¶ï¼Œèƒ½å¸®ä½ è‡ªåŠ¨ç”Ÿæˆç¬¦åˆæ½®æ±å®˜æ–¹è¦æ±‚çš„é¡¹ç›®ï¼Œä¼šæå¤§çš„æé«˜ä½ çš„æ•ˆç‡ã€‚

pdm-levæš‚ä¸æä¾›å‡çº§æ–¹æ³•ï¼Œéœ€è¦æ‰‹åŠ¨å‡çº§ï¼š

```bash
$ pdm plugin remove pdm-lev
$ pdm plugin add pdm-lev
```



   è‡³æ­¤ï¼Œç¯å¢ƒé…ç½®å®Œæˆï¼Œå¼€å§‹[ä¸‹ä¸€æ­¥](#å‡­è¯ä¸Šä¼ ä¸è·å–)ã€‚
